# 汇编语言 - 王爽

# 第 1 章 基础知识

CPU（Central Processing Unit，中央处理单元）

一根导线具有高低两种电平，只能传送 1 和 0 两种数据。

- 地址总线的数量影响寻址长度，一个 CPU 具有 N 根地址总线，这可以说这个 CPU 的地址总线的宽度为 N。这样的 CPU 最多可以寻找 2 的 N 次方个内存单元。

- 数据总线的数量影响一次传输的数据大小，8 根数据线，要传数字 89D8H，需要分两次，而 16 根数据线，则一次就足够了。

- 控制总线决定了 CPU 对外部器件的控制能力。

## 第 2 章 寄存器

CPU 职责：

1. 运算器进行信息处理；
2. 寄存器进行信息存储；
3. 控制器控制各种器件进行工作；
4. 内部总线连接各种器件，在他们之间进行数据的传送。

- 8086 CPU 的寄存器（14 个、均为 16 位）：

通用寄存器（用来存放一般数据）：AX BX CX DX 

为了兼容基于上代 CPU 编写的程序，1 个通用寄存器可分为 2 个 8 位寄存器使用。

AX => AH + AL
BX => BH + BL
CX => XH + CL
DX => DH + DL

SI DI SP BP IP CS SS DS ES PSW

1 个字节（byte），由 8 个 bit 组成。
1 个字（word），由 2 个 byte 组成，分别成为高、低位字节。

- 汇编指令

mov ax, 18 => 将 18 送入寄存器 AX      => AX = 18
add ax, 8  => 将寄存器 AX 中的数值加 8 => AX = AX + 8

- 16 位 CPU 的定义

1. 运算器一次最多可以处理 16 位的数据；
2. 寄存器的最大宽度为 16 位；
3. 寄存器和运算器之间的通路为 16 位。

- 物理地址 = 段地址 x 16 + 偏移地址
            （基础地址）

- 段寄存器 CS SS DS ES

CS 为代码段寄存器（Code Segment）
IP 为指令指针寄存器（Pnstruction Pointer）

CPU 将会执行 CS:IP 所指向的指令内存地址

- CPU 执行一条指令的过程

1. CPU 从 CS:IP 处读取指令；
2. CS、IP 中的内容送入地址加法器（物理地址 = 段地址 x 16 + 偏移地址）；
3. 地址加法器将物理地址送入输入输出控制电路；
4. 输入输出控制电路将物理地址送入地址总线；
5. 物理地址存放的对应指令通过数据总线传回 CPU；
6. 输入输出控制电路将指令送入指令缓冲器；
7. IP 数值将增加，偏移至下一条指令；
8. 执行控制器执行指令；
9. 执行后 AX 中的内容被改变。

- Debug 功能

1. Debug 的 R 命令，查看和改变 CPU 寄存器的内容；
2. Debug 的 D 命令，查看内存中的内容；
3. Debug 的 E 命令，改写内存中的内容；
4. Debug 的 U 命令，将内存中的机器指令翻译为汇编指令；
5. Debug 的 T 命令，执行一条机器语句；
6. Debug 的 A 命令，以汇编指令的格式在内存中写入一条机器指令。

r，查看所有寄存器中的数值。
r ax，改变寄存器中的数值。
d，查看内存中的内容。
d 段地址:偏移地址，查看指定地址内存内容。
d 段地址:起始偏移地址 结尾偏移地址，限定范围查看内存内容。
e 起始地址 数据 数据 数据 数据……，修改内存数据。
e 起始地址，使用询问的方式一次写入数据，空格表示确认当前数据。
u 起始地址，查看此地址中内容的机器指令。
t，执行 CS:IP 指向的机器指令。
a 起始地址，以汇编代码的形式写入指令。
q 退出 debug。
p 执行中断指令。
g 地址，直接执行到此地址所在的指令处。
p 执行完当前 loop 指令直到循环结束。

## 第 3 章 寄存器（内存访问）

- DS 数据段寄存器（Data Segment）

只能使用寄存器传送至 DS，不能直接数值。

使用 [x] 访问内存地址，内存基于 DS 偏移。

```assembly
mov bx, 1000H
mov ds, bx
mov al, [0]
```

- mov、add、sub 指令

mov 寄存器, 数据
mov 寄存器, 寄存器
mov 寄存器, 内存单元
mov 内存单元, 寄存器
mov 段寄存器, 寄存器
mov 寄存器, 段寄存器
mov 内存单元, 段寄存器
mov 段寄存器, 内存单元
add 寄存器, 数据
add 寄存器, 寄存器
add 寄存器, 内存单元
add 内存单元, 寄存器
sub 寄存器, 数据
sub 寄存器, 寄存器
sub 寄存器, 内存单元
sub 内存单元, 寄存器

- CPU 栈机制

任意时刻 SS:SP 指向栈顶元素

SS 栈段寄存器（Stack Segment）
SP 栈指针寄存器（Stack Pointer）

- push、pop 指令

push 寄存器，将一个寄存器中的数据入栈
pop 寄存器，出栈、用一个寄存器接受出栈的数据
push 段寄存器，将一个段寄存器中的数据入栈
pop 段寄存器，出栈，用一个断寄存器接受出栈的数据
push 内存单元，将一个内存单元处的字入栈
pop 内存单元，出栈，用一个内存单元接受出栈的数据

## 第 4 章 第一个程序

edit 编辑源代码
masm 编译器
link 链接器

- 简化编译链接步骤

masm 1; 需要分号。
link 1; 需要分号。

- 跟踪程序

debug 1.exe 单步跟踪 1.exe 程序。

cx 将显示程序的大小

整理 VirtualBox 安装 Dos 步骤。

- Loop 指令

CS 计数寄存器（Count ）

loop 标号

当 cx 为 0 时，执行 loop 的下一条指令，否则执行标号处指令。

- 段前缀

在汇编指令中访问内存单元，可使用段名显示指定内存地址。

mov ax,ds:[]
mov ax,cs:[]
mov ax,ss:[]
mov ax,es:[]

“ds”、“cs”、“ss”、“es”，被称为“段前缀”。

- 安全空间

一般 DOS 和其他合法程序不会使用 0:200~02ff 这段内存，所以是安全的。